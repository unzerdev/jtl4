!function(e,t,r,n){function a(e,t){try{var r=escape(e[t]);r=(r=(r=r.replace("%E2%u201A%AC",unescape("%u20AC"))).replace("%C2%A3",unescape("%u00A3"))).replace("%E2%u201A%AB",unescape("%u20AB")),e[t]=decodeURIComponent(r)}catch(r){e[t]=unescape(escape(e[t]).replace("%C3%u201E","%C4")),e[t]=unescape(escape(e[t]).replace("%C3%u0178","%DF"))}return e[t]}function i(e){return Array.prototype.slice.call(e.getElementsByTagName("*"),0).filter(function(e){if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++)if(1==e.childNodes[t].nodeType)return!1;return!0})}function s(e){e.reverse().forEach(function(e){e.addedNodes.forEach(function(e){e instanceof HTMLElement&&(i(e).forEach(function(e){"i"==e.tagName.toLowerCase()&&""!==e.parentElement.textContent.trim()&&a(e.parentElement,"innerHTML"),a(e,"innerText")}),e.dataset.selectText&&a(e.dataset,"selectText"))})})}function o(t,a,i){var o=e(".unzerUI.form").get(0);!o||r.characterSet!=n&&"utf-8"===r.characterSet.toLowerCase()||new MutationObserver(s).observe(o,{childList:!0,characterData:!0,subtree:!0}),this.settings=i||{};var l={locale:this.settings.locale||"de-DE"};this.unzerInstance=new unzer(t,l),this.customerId=i.customerId||null,this.customerResource=null,this.paymentType=this.initPaymentType(a),this.$errorContainer=this.settings.$errorContainer||e("#error-container"),this.$errorMessage=this.settings.$errorMessage||this.$errorContainer.find(".alert"),this.form=this.settings.form||r.getElementById("form_payment_extra"),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.form.addEventListener("submit",this.handleFormSubmit),this.paymentType.hasOwnProperty("addEventListener")&&this.paymentType.addEventListener("change",c),this.customerResource&&this.customerResource.hasOwnProperty("addEventListener")&&this.customerResource.addEventListener("validate",c),this.paymentType.hasOwnProperty("_setInputError")&&u(this.paymentType),this.paymentType.ibanInstance&&this.paymentType.ibanInstance.hasOwnProperty("_setInputError")&&u(this.paymentType.ibanInstance),this.settings.autoSubmit&&this.handleFormSubmit(new Event("submit"))}var c=function(t){t.success||e(".unzerUI.error").each(function(e,t){a(t,"innerText")})},u=function(e){var t=e._setInputError;e._setInputError=function(){a(arguments,1),t.apply(e,arguments)}};o.PAYMENT_TYPES={ALIPAY:"Alipay",CARD:"Card",EPS:"EPS",FLEXIPAY_DIRECT:"FlexiPay Direct",HIRE_PURCHASE:"Hire Purchase",PAYPAL:"Paypal",INVOICE:"Invoice",INVOICE_FACTORING:"Invoice Factoring",INVOICE_GUARANTEED:"Invoice Guaranteed",SEPA:"SEPA",SEPA_GUARANTEED:"SEPA (guaranteed)",SOFORT:"SOFORT",GIROPAY:"Giropay",PRZELEWY24:"Przelewy24",IDEAL:"iDEAL",PREPAYMENT:"Prepayment",WECHAT_PAY:"WeChat Pay"},o.prototype.initPaymentType=function(e){switch(e){case o.PAYMENT_TYPES.CARD:return this.createCard();case o.PAYMENT_TYPES.INVOICE:return this.createInvoice();case o.PAYMENT_TYPES.INVOICE_GUARANTEED:return this.createInvoiceGuaranteed();case o.PAYMENT_TYPES.INVOICE_FACTORING:return this.createInvoiceFactoring();case o.PAYMENT_TYPES.SEPA:return this.createSepa();case o.PAYMENT_TYPES.SEPA_GUARANTEED:return this.createSepaGuaranteed();case o.PAYMENT_TYPES.PAYPAL:return this.createPaypal();case o.PAYMENT_TYPES.SOFORT:return this.createSofort();case o.PAYMENT_TYPES.GIROPAY:return this.createGiropay();case o.PAYMENT_TYPES.PRZELEWY24:return this.createPrzelewy24();case o.PAYMENT_TYPES.IDEAL:return this.createIdeal();case o.PAYMENT_TYPES.PREPAYMENT:return this.createPrepayment();case o.PAYMENT_TYPES.EPS:return this.createEPS();case o.PAYMENT_TYPES.FLEXIPAY_DIRECT:return this.createFlexiPayDirect();case o.PAYMENT_TYPES.ALIPAY:return this.createAlipay();case o.PAYMENT_TYPES.WECHAT_PAY:return this.createWeChatPay();case o.PAYMENT_TYPES.HIRE_PURCHASE:return this.createHirePurchase();default:throw new Error("Unkown Payment Type: "+e)}},o.prototype.handleFormSubmit=function(e){var t=this;e.preventDefault();var n=[this.paymentType.createResource()];this.customerResource&&n.push(this.customerId?this.customerResource.updateCustomer():this.customerResource.createCustomer()),Promise.all(n).then(function(e){var n=r.createElement("input");if(n.setAttribute("type","hidden"),n.setAttribute("name","paymentData[resourceId]"),n.setAttribute("value",e[0].id),t.form.appendChild(n),e.length>=2){var a=r.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name","paymentData[customerId]"),a.setAttribute("value",e[1].id),t.form.appendChild(a)}t.form.removeEventListener("submit",t.handleFormSubmit),t.form.submit()}).catch(function(e){t.$errorContainer.show(),t.$errorMessage.html(a(e,"message"))})},o.prototype.createCustomer=function(){var e=this.settings.isB2B?this.unzerInstance.B2BCustomer():this.unzerInstance.Customer();if(e.initFormFields(this.settings.customer||{}),this.customerId){var t={containerId:"customer",fields:["birthdate"],showInfoBox:!1,showHeader:!1};return this.settings.isB2B&&(t={containerId:"customer"}),e.update(this.customerId,t),e}return e.create({containerId:"customer",showInfoBox:!1,showHeader:!1}),e},o.prototype.createCard=function(){var e=this.unzerInstance.Card(),t={fontSize:null,fontColor:null,fontFamily:null};this.settings.styling&&(t.fontColor=this.settings.styling.fontColor||null,t.fontSize=this.settings.styling.fontSize||null,t.fontFamily=this.settings.styling.fontFamily||null),e.create("number",{containerId:"card-element-id-number",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily}),e.create("expiry",{containerId:"card-element-id-expiry",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily}),e.create("cvc",{containerId:"card-element-id-cvc",onlyIframe:!1,fontSize:t.fontSize,fontColor:t.fontColor,fontFamily:t.fontFamily});var n=this,i={},s=n.settings.submitButton||r.getElementById("submit-button");s.setAttribute("disabled",!0);return e.addEventListener("change",function(e){e.success&&(i[e.type]=!0,n.$errorContainer.hide(),n.$errorMessage.html()),e.error&&(i[e.type]=!1,n.$errorContainer.show(),n.$errorMessage.html(a(e,"error"))),i.number&&i.expiry&&i.cvc?s.removeAttribute("disabled"):s.setAttribute("disabled",!0)}),e},o.prototype.createInvoice=function(){return this.unzerInstance.Invoice()},o.prototype.createInvoiceGuaranteed=function(){return this.customerResource=this.createCustomer(),this.unzerInstance.InvoiceSecured()},o.prototype.createInvoiceFactoring=function(){return this.customerResource=this.createCustomer(),this.unzerInstance.InvoiceSecured()},o.prototype.createSepa=function(){var e=this.unzerInstance.SepaDirectDebit();return e.create("sepa-direct-debit",{containerId:"sepa-IBAN"}),e},o.prototype.createSepaGuaranteed=function(){var e=this.unzerInstance.SepaDirectDebitSecured();return e.create("sepa-direct-debit-guaranteed",{containerId:"sepa-guaranteed-IBAN"}),this.customerResource=this.createCustomer(),e},o.prototype.createPaypal=function(){var e=this.unzerInstance.Paypal();return e.create("email",{containerId:"paypal-element-email"}),e},o.prototype.createSofort=function(){return this.unzerInstance.Sofort()},o.prototype.createGiropay=function(){return this.unzerInstance.Giropay()},o.prototype.createPrzelewy24=function(){return this.unzerInstance.Przelewy24()},o.prototype.createIdeal=function(){var e=this.unzerInstance.Ideal();return e.create("ideal",{containerId:"ideal-element"}),e},o.prototype.createPrepayment=function(){return this.unzerInstance.Prepayment()},o.prototype.createEPS=function(){var e=this.unzerInstance.EPS();return e.create("eps",{containerId:"eps-element"}),e},o.prototype.createFlexiPayDirect=function(){return this.unzerInstance.FlexiPayDirect()},o.prototype.createAlipay=function(){return this.unzerInstance.Alipay()},o.prototype.createWeChatPay=function(){return this.unzerInstance.Wechatpay()},o.prototype.createHirePurchase=function(){var e=this.unzerInstance.InstallmentSecured(),t=this;this.customerResource=this.createCustomer();var n=t.settings.submitButton||r.getElementById("submit-button");return n.setAttribute("style","display: none"),n.setAttribute("disabled",!0),e.create({containerId:"hire-purchase-element",amount:this.settings.amount||null,currency:this.settings.currency||null,effectiveInterest:this.settings.effectiveInterest||null,orderDate:this.settings.orderDate||null}).then(function(e){}).catch(function(e){var r="";console.error(e.message),e.error.details.forEach(function(e){console.error("API-Error: "+e.code),r+=e.customerMessage}),t.$errorContainer.show(),t.$errorMessage.html(r)}),e.addEventListener("installmentSecuredEvent",function(e){if("validate"===e.action){if(e.success)return void n.removeAttribute("disabled");n.setAttribute("disabled",!0)}if("change-step"===e.action){if("plan-list"===e.currentSteep)return n.setAttribute("style","display: none"),void n.setAttribute("disabled",!0);n.setAttribute("style","display: inline-block")}}),e},t.HpPayment=o,t.HpInstalment=function(t,r,n){var a=e(t);r.addEventListener("click",function(){n.trigger("submit")}),n.on("submit",function(e){return!!a.is(":visible")||(e.preventDefault(),a.modal("show"),!1)})}}(jQuery,window,window.document);